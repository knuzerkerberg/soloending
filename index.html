<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ëª¨ì†”íƒˆì¶œ! AI ì¹´í†¡ ì½”ì¹˜ (ChatGPT)</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background-color: #f0f2f5;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    textarea, select, input[type="password"] {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      margin-bottom: 15px;
      font-size: 1em;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      padding: 12px 20px;
      background-color: #10a37f;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1em;
      margin-top: 10px;
    }
    button:hover {
      background-color: #0c7a60;
    }
    .loader {
      display: none;
      margin: 20px auto;
      border: 6px solid #f3f3f3;
      border-top: 6px solid #10a37f;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .results-area {
      margin-top: 20px;
    }
    .card {
      background: #ffffff;
      border-left: 6px solid #10a37f;
      margin-bottom: 15px;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .card h4 {
      margin: 0 0 10px;
      font-size: 1.1em;
    }
    .card p {
      margin: 0;
      line-height: 1.5em;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ’Œ AI ì¹´í†¡ ì½”ì¹˜ (ChatGPT)</h2>

    <label><input type="checkbox" id="adminToggle"> ê´€ë¦¬ì ëª¨ë“œ</label>

    <div id="adminSection" style="display:none;">
      <h3>ChatGPT ì§€ì‹œë¬¸(í”„ë¡¬í”„íŠ¸) ì„¤ì •</h3>
      <textarea id="adminPrompt" placeholder="ì˜ˆ: ë„ˆëŠ” ì¹œì ˆí•˜ê³  ì„¼ìŠ¤ ìˆëŠ” ì—°ì•  ìƒë‹´ê°€ì•¼. ë§íˆ¬ëŠ” ..."></textarea>
      <button onclick="savePrompt()">í”„ë¡¬í”„íŠ¸ ì €ì¥</button>
    </div>

    <div id="userSection">
      <textarea id="herMessage" placeholder="ê·¸ë…€ì˜ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ: ì˜¤ëŠ˜ ë­í–ˆì–´?"></textarea>
      <textarea id="chatHistory" placeholder="(ì„ íƒì‚¬í•­) ìµœê·¼ ëŒ€í™” íë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”."></textarea>

      <select id="toneSelector">
        <option value="">-- ë§íˆ¬ ìŠ¤íƒ€ì¼ ì„ íƒ --</option>
        <option value="ê·€ì—½ê²Œ">ê·€ì—½ê²Œ</option>
        <option value="ìœ ë¨¸ ìˆê²Œ">ìœ ë¨¸ ìˆê²Œ</option>
        <option value="ì§„ì§€í•˜ê²Œ">ì§„ì§€í•˜ê²Œ</option>
        <option value="ë‹¤ì •í•˜ê²Œ">ë‹¤ì •í•˜ê²Œ</option>
      </select>

      <select id="languageSelector">
        <option value="í•œêµ­ì–´">í•œêµ­ì–´</option>
        <option value="ì˜ì–´">ì˜ì–´</option>
      </select>

      <button onclick="getSuggestions()">ë‹µì¥ ì¶”ì²œë°›ê¸°</button>

      <select id="situationSelector">
        <option value="">-- ì„ í†¡ ìƒí™© ì„ íƒ --</option>
        <option value="ì†Œê°œíŒ…/ì²« ë§Œë‚¨ í›„">ì†Œê°œíŒ…/ì²« ë§Œë‚¨ í›„</option>
        <option value="ë™í˜¸íšŒ/ëª¨ì„ì—ì„œ ë§Œë‚œ í›„">ë™í˜¸íšŒ/ëª¨ì„ì—ì„œ ë§Œë‚œ í›„</option>
        <option value="ìš°ì—°íˆ ì•Œê²Œ ëœ ì‚¬ëŒì—ê²Œ">ìš°ì—°íˆ ì•Œê²Œ ëœ ì‚¬ëŒì—ê²Œ</option>
        <option value="ì˜¤ëœë§Œì— ì—°ë½í•  ë•Œ">ì˜¤ëœë§Œì— ì—°ë½í•  ë•Œ</option>
        <option value="ì¼ìƒì ì¸ ì•ˆë¶€/ì¸ì‚¬">ì¼ìƒì ì¸ ì•ˆë¶€/ì¸ì‚¬</option>
      </select>

      <button onclick="getPreemptiveMessage()">ì„ í†¡ ì¶”ì²œë°›ê¸°</button>
    </div>

    <div class="loader" id="loader"></div>
    <div class="results-area" id="results"></div>
  </div>

  <script>
    document.getElementById('adminToggle').addEventListener('change', (e) => {
      const isAdmin = e.target.checked;
      document.getElementById('adminSection').style.display = isAdmin ? "block" : "none";
      document.getElementById('userSection').style.display = isAdmin ? "none" : "block";
    });

    function savePrompt() {
      const prompt = document.getElementById("adminPrompt").value.trim();
      if (prompt) {
        localStorage.setItem("chatgpt_prompt", prompt);
        alert("í”„ë¡¬í”„íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
      }
    }

    function getStoredPrompt() {
      return localStorage.getItem("chatgpt_prompt") || "ë„ˆëŠ” ì„¼ìŠ¤ ìˆëŠ” ì—°ì•  ì½”ì¹˜ì•¼. ë‹µë³€ì€ ìì—°ìŠ¤ëŸ½ê³  ë§¤ë ¥ì ìœ¼ë¡œ í•´ì¤˜.";
    }

    async function callChatGPT(prompt) {
      const res = await fetch("/api/chatgpt", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt })
      });

      const data = await res.json();
      if (!data || !data.result) {
        const errorMessage = data?.error || "ChatGPT ì‘ë‹µ ì—†ìŒ";
        throw new Error(errorMessage);
      }
      return data.result;
    }

    function displayAsCards(text) {
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";
      const lines = text.split(/\n(?=\d\.\s|\*\*|â€¢|\-)/g);
      lines.forEach((line, index) => {
        if (line.trim()) {
          const card = document.createElement("div");
          card.className = "card";
          const emoji = ["ğŸ’¡", "âœ¨", "ğŸ”¥", "ğŸ§¡", "âœ…", "â—", "ğŸ’¬", "ğŸ“Œ"][index % 8];
          const parts = line.split(/[:ï¼š]\s*/);
          const title = parts[0]?.trim() || "ì¶”ì²œ";
          const content = parts.slice(1).join(": ") || line;
          card.innerHTML = `<h4>${emoji} ${title}</h4><p>${content.trim()}</p>`;
          resultsDiv.appendChild(card);
        }
      });
    }

    async function getSuggestions() {
      const herMessage = document.getElementById("herMessage").value.trim();
      const chatHistory = document.getElementById("chatHistory").value.trim();
      const tone = document.getElementById("toneSelector").value;
      const language = document.getElementById("languageSelector").value;
      const loader = document.getElementById("loader");
      const results = document.getElementById("results");

      if (!herMessage) {
        results.innerHTML = `<p style="color:red;">âš ï¸ ì¹´í†¡ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!</p>`;
        return;
      }

      loader.style.display = "block";
      results.innerHTML = "";

      let prompt = getStoredPrompt() + "\n";
      if (tone) prompt += `ë§íˆ¬ ìŠ¤íƒ€ì¼: ${tone}\n`;
      if (language === "ì˜ì–´") prompt += `ë‹µë³€ì€ ì˜ì–´ë¡œ í•´ì¤˜.\n`;
      if (chatHistory) prompt += `ìµœê·¼ ëŒ€í™”:\n${chatHistory}\n`;
      prompt += `ì—¬ìì˜ ë©”ì‹œì§€: "${herMessage}"\nì„¼ìŠ¤ ìˆëŠ” ë‹µë³€ 3ê°€ì§€ ì œì•ˆí•´ì¤˜.`;

      try {
        const reply = await callChatGPT(prompt);
        displayAsCards(reply);
      } catch (err) {
        results.innerHTML = `<p style="color:red;">ì˜¤ë¥˜: ${err.message}</p>`;
      } finally {
        loader.style.display = "none";
      }
    }

    async function getPreemptiveMessage() {
      const situation = document.getElementById("situationSelector").value;
      const loader = document.getElementById("loader");
      const results = document.getElementById("results");

      if (!situation) {
        results.innerHTML = `<p style="color:red;">âš ï¸ ìƒí™©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”!</p>`;
        return;
      }

      loader.style.display = "block";
      results.innerHTML = "";

      const prompt = getStoredPrompt() + `\nìƒí™©: ${situation}\nì„ í†¡ìœ¼ë¡œ ë³´ë‚¼ ìˆ˜ ìˆëŠ” ë©”ì‹œì§€ 2ê°œì™€ ì£¼ì˜ì  1ê°œë¥¼ ì•Œë ¤ì¤˜.`;

      try {
        const reply = await callChatGPT(prompt);
        displayAsCards(reply);
      } catch (err) {
        results.innerHTML = `<p style="color:red;">ì˜¤ë¥˜: ${err.message}</p>`;
      } finally {
        loader.style.display = "none";
      }
    }
  </script>
</body>
</html>
